@model DMS_FE.Models.ProfileViewModel
@{
    ViewData["Title"] = "Thông tin cá nhân";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">Thông tin cá nhân</h3>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(Model.Error))
                    {
                        <div class="alert alert-danger" role="alert">
                            @Model.Error
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.Success))
                    {
                        <div class="alert alert-success" role="alert">
                            @Model.Success
                        </div>
                    }

                    <form method="post" id="profileForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="Name" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="Name" name="Name" value="@Model.Name" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="Email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="Email" value="@Model.Email" readonly>
                                    <small class="form-text text-muted">Email không thể thay đổi</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="Phone" class="form-label">Số điện thoại</label>
                                    <input type="tel" class="form-control" id="Phone" name="Phone" value="@Model.Phone" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="Role" class="form-label">Vai trò</label>
                                    <input type="text" class="form-control" id="Role" value="@Model.Role" readonly>
                                    <small class="form-text text-muted">Vai trò không thể thay đổi</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="@(Model.Role == "Manager" ? "/Dashboard" : "/Student/Home")" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay lại
                            </a>
                            <div id="actionButtons">
                                <button type="button" class="btn btn-primary" id="editBtn">
                                    <i class="fas fa-edit"></i> Chỉnh sửa
                                </button>
                                <button type="submit" class="btn btn-success" id="saveBtn" style="display: none;">
                                    <i class="fas fa-save"></i> Lưu
                                </button>
                                <button type="button" class="btn btn-warning" id="cancelBtn" style="display: none;">
                                    <i class="fas fa-times"></i> Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);

        // Store original values for cancel functionality
        let originalName = '@Model.Name';
        let originalPhone = '@Model.Phone';

        // Edit button click handler
        $('#editBtn').click(function() {
            // Enable editing for editable fields
            $('#Name').prop('readonly', false);
            $('#Phone').prop('readonly', false);
            
            // Show/hide buttons
            $('#editBtn').hide();
            $('#saveBtn').show();
            $('#cancelBtn').show();
            
            // Focus on the first editable field
            $('#Name').focus();
        });

        // Cancel button click handler
        $('#cancelBtn').click(function() {
            // Restore original values
            $('#Name').val(originalName);
            $('#Phone').val(originalPhone);
            
            // Disable editing
            $('#Name').prop('readonly', true);
            $('#Phone').prop('readonly', true);
            
            // Show/hide buttons
            $('#editBtn').show();
            $('#saveBtn').hide();
            $('#cancelBtn').hide();
        });

        // Form submit handler
        $('#profileForm').submit(function(e) {
            // Validate required fields
            if (!$('#Name').val().trim()) {
                e.preventDefault();
                alert('Họ và tên không được để trống');
                return false;
            }
            
            // Disable editing after successful save
            $('#Name').prop('readonly', true);
            $('#Phone').prop('readonly', true);
            
            // Show/hide buttons
            $('#editBtn').show();
            $('#saveBtn').hide();
            $('#cancelBtn').hide();
            
            // Update original values
            originalName = $('#Name').val();
            originalPhone = $('#Phone').val();
        });
    </script>
} 